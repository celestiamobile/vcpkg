diff --git a/src/msvcbuild.bat b/src/msvcbuild.bat
index cb86ada..5c82d5e 100644
--- a/src/msvcbuild.bat
+++ b/src/msvcbuild.bat
@@ -16,8 +16,8 @@
 @rem Add more debug flags here, e.g. DEBUGCFLAGS=/DLUA_USE_ASSERT
 @set DEBUGCFLAGS=
 @set LJCOMPILE=cl /nologo /c /O2 /W3 /D_CRT_SECURE_NO_DEPRECATE /D_CRT_STDIO_INLINE=__declspec(dllexport)__inline
-@set LJDYNBUILD=/DLUA_BUILD_AS_DLL /MD
-@set LJDYNBUILD_DEBUG=/DLUA_BUILD_AS_DLL /MDd 
+@set LJDYNBUILD=/DLUA_BUILD_AS_DLL
+@set LJDYNBUILD_DEBUG=/DLUA_BUILD_AS_DLL
 @set LJCOMPILETARGET=/Zi
 @set LJLINKTYPE=/DEBUG /RELEASE
 @set LJLINKTYPE_DEBUG=/DEBUG
@@ -104,7 +104,7 @@ buildvm -m folddef -o lj_folddef.h lj_opt_fold.c
 @set LJLINK=%LJLINK% %LJLINKTYPE% %LJLINKTARGET%
 @if "%1"=="amalg" goto :AMALGDLL
 @if "%1"=="static" goto :STATIC
-%LJCOMPILE% %LJDYNBUILD% lj_*.c lib_*.c
+%LJCOMPILE% %LJDYNBUILD% lj_*.c lib_*.c /Fdlua51.pdb
 @if errorlevel 1 goto :BAD
 %LJLINK% /DLL /OUT:%LJDLLNAME% lj_*.obj lib_*.obj
 @if errorlevel 1 goto :BAD
@@ -117,7 +117,7 @@ buildvm -m folddef -o lj_folddef.h lj_opt_fold.c
 @goto :MTDLL
 :AMALGDLL
 @if "%2"=="static" goto :AMALGSTATIC
-%LJCOMPILE% %LJDYNBUILD% ljamalg.c
+%LJCOMPILE% %LJDYNBUILD% ljamalg.c /Fdluajit.pdb
 @if errorlevel 1 goto :BAD
 %LJLINK% /DLL /OUT:%LJDLLNAME% ljamalg.obj lj_vm.obj
 @if errorlevel 1 goto :BAD
@@ -155,8 +155,8 @@ if exist luajit.exe.manifest^
 @echo.
 @echo *******************************************************
 @echo *** Build FAILED -- Please check the error messages ***
-@echo *******************************************************
+@echo ******************************************************* 
 @goto :END
 :FAIL
-@echo You must open a "Visual Studio Command Prompt" to run this script
+@exit 1
 :END
